# Матрица Соответствия Расширенному ТЗ QuizBattle

Источник сверки: `/Users/vladikgolosnoi/Downloads/СБЕР_Кейс_QuizBattle.docx` (расширенная версия).

## 1. Обязательная часть

### 1.1 Главная страница
- [x] Ввод `PIN + имя` для входа игрока.
- [x] Создание комнаты ведущим.
- [x] Настройки при создании: тема + количество вопросов `5/6/7`.
- Где реализовано:
  - UI: `client/src/App.tsx`
  - Backend события: `host:createRoom`, `player:joinRoom` в `server/index.js`

### 1.2 Создание игры (Backend)
- [x] Генерация уникального PIN из 6 символов `A-Z0-9`.
- [x] Уникальность PIN среди активных комнат.
- [x] Состояния игры: ожидание/идет/завершена (дополнительно: `preparing`, `paused`).
- Где реализовано:
  - `generatePin`, `createUniquePin`, `room.status` в `server/index.js`

### 1.3 Комната ожидания
- [x] Крупный PIN.
- [x] Список подключенных игроков.
- [x] Автораспределение на 2 команды.
- [x] Визуальное отличие команд.
- [x] Старт только от создателя комнаты.
- [x] Переход всех участников на игровой экран при старте.
- Где реализовано:
  - UI лобби: `client/src/App.tsx`
  - Логика ролей/команд: `assignTeam`, `rebalanceTeamsInLobby`, `host:startGame` в `server/index.js`

### 1.4 Игровой процесс
- [x] Поочередные вопросы `A -> B`.
- [x] Видно, кто отвечает сейчас.
- [x] Таймер на каждый вопрос.
- [x] 4 варианта, один правильный.
- [x] Блокировка после отправки.
- [x] Таймаут = проигранный вопрос.
- Где реализовано:
  - Раунды: `buildRounds`, `resolveRound`, `tick`-цикл в `server/index.js`
  - UI раунда: `client/src/App.tsx`

### 1.5 Подсчет очков
- [x] Базово `+1` за правильный ответ.
- [x] Счет обновляется в realtime.
- [x] Победитель/ничья после завершения.
- Где реализовано:
  - `scoreForAnswer`, `computeWinnerState`, `finishGame` в `server/index.js`

### 1.6 Технические требования
- [x] Realtime на WebSockets (Socket.IO).
- [x] Активные игры в оперативной памяти.
- [x] При отключении игрок удаляется из активного состава.
- Где реализовано:
  - `rooms`/`socketToRoom` map + `disconnect` обработчики в `server/index.js`

## 2. Дополнительная часть (Nice To Have)

### 2.1 AI
- [x] Интеграция AI-провайдеров.
- [x] Генерация по пользовательской теме.
- [x] Fallback без внешнего API.
- [x] Обработка ошибок/таймаутов без падения матча.
- Где реализовано:
  - `server/questionGenerator.js`
  - Контроль старта генерации: `START_GENERATION_TIMEOUT_MS`, `FALLBACK_GENERATION_TIMEOUT_MS` в `server/index.js`

### 2.2 Интерфейс
- [x] Адаптивный дизайн.
- [x] Анимации состояний/переходов.
- [x] Звуковые сигналы.
- [x] Темная тема.
- Где реализовано:
  - `client/src/styles.css`, `client/src/App.tsx`

### 2.3 Игровые улучшения
- [x] Выбор сложности (`mixed/easy/medium/hard`).
- [x] Speed bonus.
- [x] Пропуск вопроса.
- [x] Режим `FFA`.
- [x] Режим `Дуэль 1 на 1` с ограничением на 2 игроков.
- Где реализовано:
  - Настройки комнаты + расчет очков в `server/index.js`
  - UI переключатели в `client/src/App.tsx`

### 2.4 Администрирование
- [x] Панель ведущего (пауза/следующий/дисквалификация).
- [x] Статистика после игры.
- [x] Экспорт результатов.
- Где реализовано:
  - Socket-события `host:togglePause`, `host:nextRound`, `host:kickPlayer`, `host:exportResults`
  - UI админ-панели и аналитики в `client/src/App.tsx`

### 2.5 Технические улучшения
- [x] История игр в БД.
- [x] Регистрация и профили.
- [x] Рейтинг игроков.
- [x] Комнаты с паролем.
- [x] Отдельный каталог активных комнат с поиском и быстрым входом.
- Где реализовано:
  - `server/database.js`
  - HTTP API `/api/auth/*`, `/api/leaderboard`, `/api/history`, `/api/profile/:username`, `/api/rooms` в `server/index.js`

## 3. Дополнительные усиления проекта

- [x] Устойчивость к обрывам связи (rejoin для хоста/игроков).
- [x] Гибридный AI-режим как дефолт на сервере.
- [x] Поделиться итогом матча (web share / clipboard fallback).
- [x] Полная документация: пользовательская, разработческая, деплой.

## 4. Артефакты по ТЗ

- [x] Рабочее веб-приложение локально.
- [x] README с запуском, стеком и ролями.
- [x] Документация для пользователя/разработчика.
- [x] Презентация 3-5 минут (структура и текст защиты).

Материалы презентации: `docs/PRESENTATION_SCRIPT_RU.md`.
